<div class="p-8 bg-linear-to-br from-emerald-50 via-white to-teal-50 min-h-screen space-y-10">
    <!-- Page Header -->
    <div class="flex flex-col gap-1">
        <h1 class="text-3xl font-bold text-gray-800">Purchases</h1>
        <p class="text-gray-500">Track and manage all purchase records</p>
    </div>

    <!-- Top Actions -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex gap-3">
            <select class="px-4 py-2 rounded-xl bg-white shadow text-gray-700 border border-gray-200">
                <option>Filter by Supplier</option>
                @for (item of suppliers; track $index) {
                <option>{{item.name}}</option>
                }
            </select>

            <select class="px-4 py-2 rounded-xl bg-white shadow text-gray-700 border border-gray-200">
                <option>Status</option>
                <option>Completed</option>
                <option>Pending</option>
            </select>
        </div>
        <!-- class="px-5 py-2 bg-emerald-600 text-white font-semibold rounded-xl shadow hover:bg-emerald-700 transition duration-300" -->
        <button command="show-modal" commandfor="dialog"
            class="px-5 py-2 bg-emerald-600 text-white font-semibold rounded-xl shadow hover:bg-emerald-700 transition duration-300">Add
            Purchase
        </button>
        <el-dialog>
            <dialog id="dialog" aria-labelledby="dialog-title"
                class="fixed inset-0 size-auto max-h-auto max-w-auto overflow-y-auto bg-transparent backdrop:bg-transparent">
                <el-dialog-backdrop
                    class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></el-dialog-backdrop>

                <div tabindex="0"
                    class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
                    <el-dialog-panel
                        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div
                                    class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                    <div
                                        class="bg-white w-full max-w-3xl rounded-3xl shadow-2xl p-8 border border-gray-200">

                                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Add Purchase</h2>

                                        <form class="space-y-6">

                                            <!-- Customer -->
                                            <div>
                                                <label class="text-sm font-medium text-gray-700">Supplier</label>
                                                <select formControlName="customerId"
                                                    class="w-full border px-3 py-2.5 rounded-xl shadow-sm bg-white focus:ring-2 focus:ring-indigo-500">
                                                    <option value="" disabled>Select Supplier</option>

                                                    @for (item of suppliers; track $index) {
                                                    <option [value]="item.id">{{item.name}}</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Items Section -->
                                            <div class="bg-gray-50 rounded-2xl p-5 shadow-inner border border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Invoice Items</h3>

                                                <div formArrayName="items">

                                                    @for (item of items.controls; track item; let i = $index) {

                                                    <div
                                                        class="grid grid-cols-6 gap-4 bg-white p-5 rounded-2xl shadow-md border border-gray-100 mb-3">

                                                        <!-- Product -->
                                                        <div class="col-span-2">
                                                            <label class="text-sm text-gray-600">Product</label>
                                                            <select formControlName="productId"
                                                                class="w-full border px-3 py-2.5 rounded-lg bg-white shadow-sm"
                                                                (change)="updatePrice(i)">
                                                                <option value="" disabled selected>Select product
                                                                </option>

                                                                @for (p of productsList; track p.productId) {
                                                                <option [value]="p.productId">{{ p.productName }}
                                                                </option>
                                                                }
                                                            </select>
                                                        </div>

                                                        <!-- Qty -->
                                                        <div>
                                                            <label class="text-sm text-gray-600">Qty</label>
                                                            <input type="number" formControlName="quantity"
                                                                (input)="recalculateLine(i)"
                                                                class="w-full border px-3 py-2.5 rounded-lg shadow-sm" />
                                                        </div>

                                                        <!-- Price -->
                                                        <div>
                                                            <label class="text-sm text-gray-600">Price</label>
                                                            <input type="number" formControlName="sellingPrice"
                                                                class="w-full border px-3 py-2.5 rounded-lg shadow-sm" />
                                                        </div>

                                                        <!-- Line Total -->
                                                        <div class="flex flex-col justify-end">
                                                            <span class="text-gray-600 text-sm">Total</span>
                                                            <span class="font-semibold text-gray-900">
                                                                GHC {{ item.get('lineTotal')?.value }}
                                                            </span>
                                                        </div>

                                                        <!-- Remove -->
                                                        <div class="flex items-end justify-end">
                                                            <button type="button" (click)="removeItem(i)"
                                                                class="text-red-600 hover:text-red-700 font-medium hover:underline">
                                                                Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                    }
                                                </div>
                                            </div>
                                            <button type="button" (click)="addItem()"
                                                class="mt-2 text-indigo-600 hover:underline font-medium">
                                                + Add Item
                                            </button>
                                            <!-- Final Total -->
                                            <div class="flex justify-between text-xl font-semibold text-gray-800 pt-3">
                                                <span>Total Amount:</span>
                                                <span>GHC </span>
                                            </div>
                                        </form>
                                        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                                            <button type="button" command="close" commandfor="dialog"
                                                class="inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-xs sm:ml-3 sm:w-auto  bg-emerald-600 hover:bg-emerald-700 transition duration-300">Add</button>
                                            <button type="button" command="close" commandfor="dialog"
                                                class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-dialog-panel>
                </div>
            </dialog>
        </el-dialog>

    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div
            class="bg-linear-to-br from-emerald-500 to-emerald-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-emerald-100">Total Purchases</p>
            <h2 class="text-3xl font-bold mt-1">GHC 24,580</h2>
        </div>

        <div
            class="bg-linear-to-br from-teal-500 to-teal-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-teal-100">Suppliers</p>
            <h2 class="text-3xl font-bold mt-1">{{suppliers.length}}</h2>
        </div>

        <div
            class="bg-linear-to-br from-blue-500 to-blue-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-blue-100">Pending Orders</p>
            <h2 class="text-3xl font-bold mt-1">6</h2>
        </div>

        <div
            class="bg-linear-to-br from-amber-500 to-amber-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-amber-100">Completed Today</p>
            <h2 class="text-3xl font-bold mt-1">3</h2>
        </div>
    </div>

    <!-- Purchases Table -->
    <div class="bg-white rounded-2xl shadow-xl p-6 border border-emerald-200">
        <h3 class="text-xl font-semibold text-emerald-700 mb-4">Recent Purchases</h3>

        <table class="w-full text-sm">
            <thead class="bg-emerald-50 text-emerald-700">
                <tr class="border-b border-emerald-200 text-left">
                    <th class="py-3">Purchase ID</th>
                    <th class="py-3">Supplier</th>
                    <th class="py-3">Amount</th>
                    <th class="py-3">Date</th>
                    <th class="py-3 text-center">Status</th>
                    <th class="py-3 text-center">Action</th>
                </tr>
            </thead>

            <tbody>
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">PUR-0093</td>
                    <td class="py-3">Bright Supplies</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC 2,150</td>
                    <td class="py-3">2025-12-05</td>
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    <td class="py-3 text-center"><button
                            class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700">View</button></td>
                </tr>

                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">PUR-0094</td>
                    <td class="py-3">Tech Source Ltd.</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC 860</td>
                    <td class="py-3">2025-12-04</td>
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 font-semibold">Pending</span>
                    </td>
                    <td class="py-3 text-center"><button
                            class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700">View</button></td>
                </tr>

                <tr class="hover:bg-emerald-50/50 transition">
                    <td class="py-3">PUR-0095</td>
                    <td class="py-3">Giant Traders</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC 4,320</td>
                    <td class="py-3">2025-12-03</td>
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-700 font-semibold">Delayed</span>
                    </td>
                    <td class="py-3 text-center"><button
                            class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-gray-700">View</button></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<!-- View Purchase Modal -->
<div id="viewPurchaseModal"
    class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl p-6 animate-fade-in">
        <h2 class="text-xl font-semibold text-emerald-700 mb-4">Purchase Details</h2>

        <div class="space-y-3 text-sm">
            <p><strong>Purchase ID:</strong> PUR-0093</p>
            <p><strong>Supplier:</strong> Bright Supplies</p>
            <p><strong>Total Amount:</strong> GHC 2,150</p>
            <p><strong>Date:</strong> 2025-12-05</p>
            <p><strong>Status:</strong> Completed</p>
            <p><strong>Description:</strong> Electronic accessories and hardware tools.</p>
        </div>

        <div class="mt-6 flex justify-end">
            <button onclick="document.getElementById('viewPurchaseModal').classList.add('hidden')"
                class="px-5 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium">Close</button>
        </div>
    </div>
</div>


<!-- Add Purchase Modal -->
<div id="addPurchaseModal"
    class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white w-full max-w-xl rounded-2xl shadow-2xl p-6 animate-fade-in">
        <h2 class="text-xl font-semibold text-emerald-700 mb-4">Add New Purchase</h2>

        <form class="space-y-4">
            <div>
                <label class="text-sm font-medium text-gray-700">Supplier</label>
                <input type="text" placeholder="Enter supplier name"
                    class="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-400" />
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700">Amount (GHC)</label>
                <input type="number" placeholder="Enter amount"
                    class="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-400" />
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700">Date</label>
                <input type="date"
                    class="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-400" />
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700">Status</label>
                <select class="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-emerald-400">
                    <option>Select status</option>
                    <option>Completed</option>
                    <option>Pending</option>
                    <option>Delayed</option>
                </select>
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700">Description</label>
                <textarea placeholder="Enter purchase details"
                    class="mt-1 w-full px-4 py-2 border rounded-lg h-24 focus:ring-2 focus:ring-emerald-400"></textarea>
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button type="button" onclick="document.getElementById('addPurchaseModal').classList.add('hidden')"
                    class="px-5 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium">Cancel</button>
                <button
                    class="px-5 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-semibold">Save</button>
            </div>
        </form>
    </div>
</div>