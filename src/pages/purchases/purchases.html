<div class="p-8 bg-linear-to-br from-emerald-50 via-white to-teal-50 min-h-screen space-y-10">
    <!-- Page Header -->
    <div class="flex flex-col gap-1">
        <h1 class="text-3xl font-bold text-gray-800">Purchases</h1>
        <p class="text-gray-500">Track and manage all purchase records</p>
    </div>

    <!-- Top Actions -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center justify-between w-full">

            <!-- Left Side -->
            <div class="flex">
                <select (change)="onSelectedChange($event)"
                    class="px-4 py-2 rounded-xl bg-white shadow text-gray-700 border border-gray-200">
                    <option>Status</option>
                    <option value="all">All</option>
                    <option value="completed">Completed</option>
                    <option value="pending">Pending</option>
                    <option value="delayed">Delayed</option>
                </select>
            </div>

            <!-- Right Side -->
            <button command="show-modal" commandfor="dialog"
                class="px-5 py-2 bg-emerald-600 text-white font-semibold rounded-xl shadow hover:bg-emerald-700 transition duration-300">
                Add Purchase
            </button>

        </div>

        <el-dialog>
            <dialog id="dialog" aria-labelledby="dialog-title"
                class="fixed inset-0 size-auto max-h-auto max-w-auto overflow-y-auto bg-transparent backdrop:bg-transparent">
                <el-dialog-backdrop
                    class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></el-dialog-backdrop>

                <div tabindex="0"
                    class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
                    <el-dialog-panel
                        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
                        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div
                                    class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                    <div
                                        class="bg-white w-full max-w-3xl rounded-3xl shadow-2xl p-8 border border-gray-200">

                                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Add Purchase</h2>

                                        <div class="p-6 max-w-4xl mx-auto bg-white shadow-xl rounded-3xl">
                                            <h2 class="text-2xl font-semibold mb-5">Create Purchase</h2>

                                            <div class="p-6 max-w-4xl mx-auto bg-white shadow-xl rounded-3xl">
                                                <h2 class="text-2xl font-semibold mb-5">Create Purchase</h2>

                                                <form #form="ngForm">
                                                    <!-- Purchase Basic Info -->
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">

                                                        <div>
                                                            <label class="block mb-1 font-medium">Supplier Name</label>
                                                            <select name="supplier" #supplier="ngModel"
                                                                [(ngModel)]="purchased.id"
                                                                class="w-full p-2 border rounded-lg">
                                                                <option value="" disabled>Supplier</option>
                                                                @for (item of suppliers; track $index) {
                                                                <option [value]="item.id">{{item.name}}</option>
                                                                }
                                                            </select>
                                                        </div>

                                                        <div>
                                                            <label class="block mb-1 font-medium">Amount (Grand
                                                                Total)</label>
                                                            <input type="number" [(ngModel)]="purchased.amount"
                                                                class="w-full p-2 border rounded-lg bg-gray-100"
                                                                [value]="overallTotal" name="amount" readonly />
                                                        </div>

                                                        <div>
                                                            <label class="block mb-1 font-medium">Status</label>
                                                            <select class="w-full p-2 border rounded-lg"
                                                                [(ngModel)]="purchased.stat" name="stat">
                                                                <option [ngValue]="Status.Completed">Completed</option>
                                                                <option [ngValue]="Status.Pending">Pending</option>
                                                                <option [ngValue]="Status.Delayed">Delayed</option>
                                                            </select>
                                                        </div>
                                                    </div>



                                                    <!-- PURCHASE ORDERS -->
                                                    <h3 class="text-xl font-semibold mb-3">Purchase Orders</h3>

                                                    <div class="space-y-4">
                                                        @for (order of purchased.purchaseOrders; track $index) {

                                                        <div class="p-4 bg-gray-100 rounded-xl border">

                                                            <div class="grid grid-cols-1 md:grid-cols-5 gap-3">

                                                                <div>
                                                                    <label class="block mb-1 font-medium">Cost
                                                                        Price</label>
                                                                    <input type="number"
                                                                        class="w-full p-2 border rounded-lg"
                                                                        [(ngModel)]="order.costPrice"
                                                                        name="costPrice-{{$index}}"
                                                                        (input)="recalculateTotals()" />
                                                                </div>

                                                                <div>
                                                                    <label
                                                                        class="block mb-1 font-medium">Quantity</label>
                                                                    <input type="number"
                                                                        class="w-full p-2 border rounded-lg"
                                                                        [(ngModel)]="order.quantity"
                                                                        name="quantity-{{$index}}"
                                                                        (input)="recalculateTotals()" />
                                                                </div>

                                                                <div>
                                                                    <label class="block mb-1 font-medium">Product
                                                                        Name</label>
                                                                    <select name="product" #product="ngModel"
                                                                        [(ngModel)]="order.productId"
                                                                        class="w-full p-2 border rounded-lg">
                                                                        <option value="" disabled>Supplier</option>
                                                                        @for (item of productsList; track $index) {
                                                                        <option [value]="item.productId">
                                                                            {{item.productName}}</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <!-- INDIVIDUAL TOTAL -->
                                                                <div>
                                                                    <label class="block mb-1 font-medium">Total</label>
                                                                    <input type="number"
                                                                        class="w-full p-2 border rounded-lg bg-gray-200"
                                                                        [value]="orderTotals[$index]" readonly />
                                                                </div>

                                                                <div class="flex items-end">
                                                                    <button type="button"
                                                                        class="px-4 py-2 bg-red-500 text-white rounded-lg"
                                                                        (click)="removeOrder($index)">
                                                                        Remove
                                                                    </button>
                                                                </div>

                                                            </div>

                                                        </div>

                                                        }
                                                    </div>


                                                    <!-- Add Purchase Order Button -->
                                                    <div class="mt-4">
                                                        <button type="button"
                                                            class="px-4 py-2 bg-blue-600 text-white rounded-lg"
                                                            (click)="addOrder()">
                                                            + Add Purchase Order
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>


                                            <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                                                <button type="button" command="close" commandfor="dialog"
                                                    (click)="addPurchase()"
                                                    class="inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold text-white shadow-xs sm:ml-3 sm:w-auto  bg-emerald-600 hover:bg-emerald-700 transition duration-300">Add</button>
                                                <button type="button" command="close" commandfor="dialog"
                                                    class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-dialog-panel>
                </div>
            </dialog>
        </el-dialog>

    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <div
            class="bg-linear-to-br from-emerald-500 to-emerald-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-emerald-100">Total Purchases</p>
            <h2 class="text-3xl font-bold mt-1">GHC {{totalAmount}}</h2>
        </div>

        <div
            class="bg-linear-to-br from-teal-500 to-teal-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-teal-100">Suppliers</p>
            <h2 class="text-3xl font-bold mt-1">{{suppliers.length}}</h2>
        </div>

        <div
            class="bg-linear-to-br from-blue-500 to-blue-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-blue-100">Pending Orders</p>
            <h2 class="text-3xl font-bold mt-1">{{pending}}</h2>
        </div>

        <div
            class="bg-linear-to-br from-amber-500 to-amber-700 text-white p-6 rounded-2xl shadow-xl hover:scale-105 transition duration-300">
            <p class="text-sm text-amber-100">Completed Today</p>
            <h2 class="text-3xl font-bold mt-1">{{completed}}</h2>
        </div>
    </div>

    <!-- Purchases Table -->
    <div class="bg-white rounded-2xl shadow-xl p-6 border border-emerald-200">
        <h3 class="text-xl font-semibold text-emerald-700 mb-4">Recent Purchases</h3>

        <table class="w-full text-sm">
            <thead class="bg-emerald-50 text-emerald-700">
                <tr class="border-b border-emerald-200 text-left">
                    <th class="py-3">Purchase ID</th>
                    <th class="py-3">Supplier</th>
                    <th class="py-3">Amount</th>
                    <th class="py-3">Date</th>
                    <th class="py-3 text-center">Status</th>
                    <th class="py-3 text-center">Action</th>
                </tr>
            </thead>

            <tbody>
                @if(!change){
                @for (item of completedPurchase; track $index)
                {
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">{{item.purchaseId}}</td>
                    <td class="py-3">{{item.supplierName}}</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC {{item.amount}}</td>
                    <td class="py-3">{{item.date}}</td>
                    @if (item.stat == Stat.Completed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    }
                    @else if (item.stat == Stat.Pending) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100  text-yellow-500 font-semibold">Pending</span>
                    </td>
                    }@else if (item.stat == Stat.Delayed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-500 font-semibold">Delayed</span>
                    </td>
                    }
                    <td class="py-3 text-center">
                        <button (click)="openModal(item)"
                            class="rounded-md bg-gray-900 text-white px-3 py-1.5 text-sm hover:bg-gray-700">
                            View
                        </button>
                    </td>
                </tr>
                }

                }@else if (!changes) {
                @for (item of pendingPurchase; track $index)
                {
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">{{item.purchaseId}}</td>
                    <td class="py-3">{{item.supplierName}}</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC {{item.amount}}</td>
                    <td class="py-3">{{item.date}}</td>
                    @if (item.stat == Stat.Completed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    }
                    @else if (item.stat == Stat.Pending) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100  text-yellow-500 font-semibold">Pending</span>
                    </td>
                    }@else if (item.stat == Stat.Delayed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-500 font-semibold">Delayed</span>
                    </td>
                    }
                    <td class="py-3 text-center">
                        <button (click)="openModal(item)"
                            class="rounded-md bg-gray-900 text-white px-3 py-1.5 text-sm hover:bg-gray-700">
                            View
                        </button>
                    </td>
                </tr>
                }
                }@else if (!changed) {
                @for (item of delayedPurchase; track $index)
                {
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">{{item.purchaseId}}</td>
                    <td class="py-3">{{item.supplierName}}</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC {{item.amount}}</td>
                    <td class="py-3">{{item.date}}</td>
                    @if (item.stat == Stat.Completed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    }
                    @else if (item.stat == Stat.Pending) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100  text-yellow-500 font-semibold">Pending</span>
                    </td>
                    }@else if (item.stat == Stat.Delayed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-500 font-semibold">Delayed</span>
                    </td>
                    }
                    <td class="py-3 text-center">
                        <button (click)="openModal(item)"
                            class="rounded-md bg-gray-900 text-white px-3 py-1.5 text-sm hover:bg-gray-700">
                            View
                        </button>
                    </td>
                </tr>
                }
                }
                @else if (!alls){
                @for (item of allpurchases; track $index)
                {
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">{{item.purchaseId}}</td>
                    <td class="py-3">{{item.supplierName}}</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC {{item.amount}}</td>
                    <td class="py-3">{{item.date}}</td>
                    @if (item.stat == Stat.Completed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    }
                    @else if (item.stat == Stat.Pending) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100  text-yellow-500 font-semibold">Pending</span>
                    </td>
                    }@else if (item.stat == Stat.Delayed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-500 font-semibold">Delayed</span>
                    </td>
                    }
                    <td class="py-3 text-center">
                        <button (click)="openModal(item)"
                            class="rounded-md bg-gray-900 text-white px-3 py-1.5 text-sm hover:bg-gray-700">
                            View
                        </button>
                    </td>
                </tr>
                }}@else {
                @for (item of allpurchases; track $index)
                {
                <tr class="border-b hover:bg-emerald-50/50 transition">
                    <td class="py-3">{{item.purchaseId}}</td>
                    <td class="py-3">{{item.supplierName}}</td>
                    <td class="py-3 font-semibold text-emerald-700">GHC {{item.amount}}</td>
                    <td class="py-3">{{item.date}}</td>
                    @if (item.stat == Stat.Completed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700 font-semibold">Completed</span>
                    </td>
                    }
                    @else if (item.stat == Stat.Pending) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-yellow-100  text-yellow-500 font-semibold">Pending</span>
                    </td>
                    }@else if (item.stat == Stat.Delayed) {
                    <td class="py-3 text-center"><span
                            class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-500 font-semibold">Delayed</span>
                    </td>
                    }
                    <td class="py-3 text-center">
                        <button (click)="openModal(item)"
                            class="rounded-md bg-gray-900 text-white px-3 py-1.5 text-sm hover:bg-gray-700">
                            View
                        </button>
                    </td>
                </tr>
                }
                }
            </tbody>
            @if (showModal)
            {
            <div class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50">
                <div class="bg-white w-[420px] rounded-2xl shadow-2xl p-6 border border-gray-200">

                    <h2 class="text-xl font-bold mb-5">Invoice Details</h2>

                    <div class="grid grid-cols-1 gap-2 mb-4 text-sm">
                        <p><strong>Purchase ID:</strong> {{selectedInvoice.purchaseId}}</p>
                        <p><strong>Supplier Name:</strong> {{selectedInvoice.supplierName}}</p>
                        <p><strong>Date:</strong> {{selectedInvoice.date}}</p>
                        <p><strong>Total:</strong> GHC {{selectedInvoice.amount}}</p>
                        @if (selectedInvoice.stat == 0) {
                        <p><strong>Status:</strong> Completed</p>
                        }
                        @else if (selectedInvoice.stat == 1) {
                        <p><strong>Status:</strong> Pending</p>
                        }
                        @else if (selectedInvoice.stat == 2) {
                        <p><strong>Status:</strong> Delayed</p>
                        }
                    </div>

                    <table class="w-full border rounded-xl overflow-hidden mb-4">
                        <thead class="bg-gray-100 text-xs text-gray-600 uppercase">
                            <tr>
                                <th class="px-3 py-2 text-left">Product</th>
                                <th class="px-3 py-2 text-left">Qty</th>
                                <th class="px-3 py-2 text-left">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (item of selectedInvoice.purchaseOrders; track item.productName) {
                            <tr class="border-b hover:bg-gray-50 text-sm">
                                <td class="px-3 py-2">{{item.productName}}</td>
                                <td class="px-3 py-2">{{item.quantity}}</td>
                                <td class="px-3 py-2">{{item.costPrice}}</td>
                            </tr>
                            }
                        </tbody>
                    </table>

                    <div class="mt-6 text-right">
                        <button (click)="closeModal()"
                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                            Close
                        </button>
                    </div>

                </div>
            </div>
            }
        </table>
    </div>

</div>